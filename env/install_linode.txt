
June 2020
=========

Deploying & provisioning umber on cs.bennington.college

  * Create a new ssh key on my laptop (bennington_linode) .
    and added it to this machine at creation time in the linode GUI.

  * Create cs_bennington linode
     (Debian 10, Linode 4GG: 2CPU, 80GB/4GB, NewJersey ,
     added the ssh key just created)

  * Edited linode domains DNS record for bennington.college to point at

    ipv4 96.126.108.24 , ipv6 2600:3c03::f03c:92ff:fecc:bf22

  * Connect to linode as root
  
    $ ssh root@96.126.108.24

  * Create user mahoney

    $ adduser mahoney
    passwd: **********

  * Install emacs

    $ apt-get install emacs

  * Copy ~root/.ssh/authorized keys (installed by linode creation)
    to ~mahoney and changed ownership (chown mahoney:mahoney ...)

  * Add mahoney to sudo & allow without password 
  
    $ usermod -aG sudo username
    $ export EDITOR="emacs -nw "  # default editor is emacs no window
    $ visudo                      # edit sudoer's file , using emacs
         # --- add this next line -------
         mahoney ALL=(ALL) NOPASSWD:ALL

  * Connect to linode as mahoney & become root
  
    laptop$ ssh 96.126.108.24   # from laptop with user=mahoney
    remote$ sudo bash           # without password

  * Disable root ssh & secure sshd
  
    edit /etc/ssh/sshd_config to include
       PermitRootLogin no
       PasswordAuthentication no
       AddressFamily inet

    $ systemctl restart sshd

  * Remove password for mahoney (loging with ssh key only)
  
    $ sudo passwd -d mahoney

  * Copied (scp) ~/.profile, ~/.emacs from laptop:system/dot_files
    and edited host in prompt

  * Edited /etc/hosts & /etc/hostname
    -- /etc/hostname --
    cs.bennington
    -- /etc/hosts --
    127.0.0.1       localhost
    127.0.1.1       cs.bennington         # should match /etc/hostname
    96.126.108.24   cs.bennington.college

  * Edited message of the day (motd)
    Moved /etc/motd to /etc/motd_disabled
    Edited /etc/update-motd.d/10-uname
       # uname -snrvm  # original
       uname -nvm | sed "s/#1 SMP //"
       # -- displays as --                                                                            
       # cs.bennington Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64                                                
  * Enabled auto system upgrades (security stuff at least)
    $ apt-get update && apt-get upgrade -y
    $ apt-get install unattended-upgrades apt-listchanges
    $ dpkg-reconfigure -plow unattended-upgrades # tab/return to answer "Yes"

  * Set rDNS (reverse DNS) to cs.bennington.college
    in linode GUI ; linode summary >> networking >> "..." after IP address

  * Look to see which network servies are running.
    See linode.com/docs/security/securing-your-server/

    $ ss -atpu
    Netid   State    Local Address:Port        Peer Address:Port
    tcp     LISTEN   0.0.0.0:ssh               0.0.0.0:*         users:(("sshd", ...
    tcp     LISTEN   127.0.0.1:smtp            0.0.0.0:*         users:(("exim4", ...
    tcp     ESTAB    96.126.108.24:ssh     219.137.231:53487     users:(("sshd", ...
    tcp     LISTEN   [::1]:smtp                [::]:*            users:(("exim4", ...

    I do want ssh, but I don't see a need now for smtp/exim4 (email) 

    $ apt list --installed | grep exim  # exim4-base, exim4-config, exim4-deamon-light
    ... did "apt purge" on those three

    ... but it seems that some sort of smtp is still running & other stuff too,
    which I can see with nmap 

  * nmap (from my laptop)

    $ nmap -Pn cs.bennington.college
    Nmap scan report for cs.bennington.college (96.126.108.24)
    PORT    STATE    SERVICE
    22/tcp  open     ssh
    25/tcp  filtered smtp               email
    135/tcp filtered msrpc              microsoft remote procedure call
    139/tcp filtered netbios-ssn        microsoft session service
    445/tcp filtered microsoft-ds       microsoft directory srevices, 

    ... and I'm not clear on whether its a kernel thing or
    a deamon or what that's listing on these various ports.

    So I guess the simplest thing is to put in a firewall.
    linuxconfig.org/how-to-use-ufw-on-debian-10-buster-linux
    UFW - uncomplicated firewall

    $ apt install ufw
    $ ufw default deny incoming
    $ ufw default allow outgoing
    $ ufw allow 22      # ssh
    $ ufw allow 80      # http
    $ ufw allow 443     # https
    $ ufw enable
    $ ufw status
    Status: active
    To                         Action      From
    --                         ------      ----
    22                         ALLOW       Anywhere                  
    80                         ALLOW       Anywhere                  
    443                        ALLOW       Anywhere                  
    22 (v6)                    ALLOW       Anywhere (v6)             
    80 (v6)                    ALLOW       Anywhere (v6)             
    443 (v6)                   ALLOW       Anywhere (v6)  


  * And ... reboot.

  * nmap again

    $ nmap cs.bennington.college
    ... Nmap scan report for cs.bennington.college (96.126.108.24) ...
    PORT    STATE  SERVICE
    22/tcp  open   ssh
    80/tcp  closed http            (nothing installed here yet)
    443/tcp closed https           (ditto)

    Also see https://www.linode.com/docs/networking/diagnostics/

  ---- That's the basics ... now on to the specific services. ---

  * git
      laptop$ scp ~/.gitconfig cs.bennington.college: # setup my git id
      $ apt install git
      $ cd ~/.ssh
      $ ssh-keygen -t ed25519 -C "git_cs_bennington" -f git_cs_bennington
      # edit ~/.ssh/config --
        # gitab identity                                                                             
        Host github.com
          IdentityFile ~/.ssh/git_cs_bennington
      $ chmod config go-r
      # installed the key in git_cs_bennington.pub in github's GUI
      
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDVJauKHvo+6ronVDe8YF9t53OuzBN2REp0IZxPEM1GO git_cs_benning
ton


